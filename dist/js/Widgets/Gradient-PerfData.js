define(["snmd-core/js/SVGWidget","snmd-core/js/MQTT","snmd-core/js/SVGImpl/Gradient","snmd-widgets-nagios/js/Utils","js-logger"],function(s,t,a,i,e){"use strict";var r=function(e,r,o){this.opts={cls:s.srClassOpts(o,"Gradient"),range:o.range,hoffset:o.hoffset,hscale:o.hscale,coords:o.coords},void 0===o.keys?this.opts.keys=[o.key]:this.opts.keys=o.keys,this.last=[],this.states=[],this.tmap=[];var h;for(h in o.stops){this.last[h]={};var p;for(p=0;p<o.stops[h].length;p++){var n=o.stops[h][p];void 0===this.tmap[n]&&(this.tmap[n]=[]),-1===this.tmap[n].indexOf(h)&&this.tmap[n].push(h),this.last[h][n]=void 0}}this.opts.stops=Object.keys(this.last),this.grad=new a(e,r,this.opts,i.qTipConfig(this,"Performance Data",this.opts.keys)),Object.keys(this.tmap).forEach(function(s){t.srRegisterTopic(s,this)},this)};return r.prototype.handleUpdate=function(s,t){var a;try{a=JSON.parse(t)}catch(s){return void e.debug("[Nagios/Gradient-PerfData] JSON error in performance data: "+s.message)}i.qTipUpdate(s,a,this);var r;for(r=0;r<this.tmap[s].length;r++)this.last[this.tmap[s][r]][s]=void 0;var o=0,h=!1;try{this.states[s]=a.state;for(r in this.opts.keys)if(void 0!==a.perf_data[this.opts.keys[r]]){o=parseFloat(a.perf_data[this.opts.keys[r]].val);break}for(r=0;r<this.tmap[s].length;r++)this.last[this.tmap[s][r]][s]!==o&&(this.last[this.tmap[s][r]][s]=o,h=!0)}catch(t){e.debug("[Nagios/Gradient-PerfData] Error processing performance data ["+s+"]: "+t.message)}if(!1!==h){var p,n=0,d=[];for(p in this.last){o=0;var f,g=!0;for(f in this.last[p]){var c=parseFloat(this.last[p][f]);isNaN(c)&&(c=0,g=!1),o+=c,n=Math.max(n,this.states[f])}o/=Object.keys(this.last[p]).length,isNaN(o)&&(g=!1),o<this.opts.range[0]&&(o=this.opts.range[0]),o>this.opts.range[1]&&(o=this.opts.range[1]),d[p]=g?(this.opts.hoffset+(o-this.opts.range[0])*this.opts.hscale/(this.opts.range[1]-this.opts.range[0]))%360:void 0}this.grad.update(d,n)}},r});