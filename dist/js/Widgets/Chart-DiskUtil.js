define(["snmd-core/js/SVGWidget","snmd-core/js/SVGImpl/Chart","snmd-widgets-nagios/js/Utils","js-logger"],function(s,t,i,a){"use strict";var l=function(a,l,e){this.opts={axis:[{max:100,scale:"linear"}],fill:"white",desc:e,dpi:.2,cls:s.srClassOpts(e,"Chart"),lcls:["snmd-lcl-Nag","snmd-lcl-NagDisk","snmd-lcl-NagDiskUtil"],mcls:["snmd-mcl-Nag","snmd-mcl-NagDisk","snmd-mcl-NagDiskUtil"],tcls:["snmd-tcl-Nag","snmd-tcl-NagDisk","snmd-tcl-NagDiskUtil"]},this.lines=[{name:"disk_utilization",axis:0,unit:"%"}],this.desc=e,this.last=[];var n;for(n=0;n<e.topics.length;n++){this.last[e.topics[n]]=[];var r;for(r=0;r<this.lines.length;r++)this.last[e.topics[n]][r]=[]}this.chart=new t(a,l,this.opts,this.lines,i.qTipConfig(this,"Disk Utilization",this.lines.map(function(s){return s.name})))};return l.prototype.handleUpdate=function(s,t){var l;try{l=JSON.parse(t)}catch(s){return void a.debug("[Nagios/Chart-DiskUtil] JSON error in performance data: "+s.message)}i.qTipUpdate(s,l,this);var e;for(e=0;e<this.lines.length;e++){this.last[s][e].val=0,this.last[s][e].state=0;try{this.last[s][e].val=l.perf_data[this.lines[e].name].val,this.last[s][e].state=l.state}catch(s){a.debug("[Nagios/Chart-DiskUtil] Error processing performance data of "+this.lines[e].name+": "+s.message)}}var n=[],r=0;for(e=0;e<this.lines.length;e++){n[e]=0;var h;for(h in this.last){var c=parseFloat(this.last[h][e].val);isNaN(c)&&(c=0),n[e]+=100*c,r=Math.max(r,this.last[h][e].state)}}this.chart.update(l._timestamp,n,r)},l});