define(["snmd-core/js/SVGWidget","snmd-core/js/MQTT","snmd-core/js/SVGImpl/RadialGradient","snmd-widgets-nagios/js/Utils","js-logger"],function(t,s,a,i,e){"use strict";var r=function(e,r,h){this.opts={cls:t.srClassOpts(h,"RadialGradient"),range:h.range,hoffset:h.hoffset,hscale:h.hscale};var o;if(void 0!==h.clrsty)for(o=0;o<h.clrsty.length;o++)r.style[h.clrsty[o]]="";void 0===h.keys?this.opts.keys=[h.key]:this.opts.keys=h.keys,this.last=[],this.states=[],this.tmap=[];var p;for(p in h.stops){this.last[p]={};var n;for(n=0;n<h.stops[p].length;n++){var d=h.stops[p][n];void 0===this.tmap[d]&&(this.tmap[d]=[]),-1===this.tmap[d].indexOf(p)&&this.tmap[d].push(p),this.last[p][d]=void 0}}this.opts.stops=Object.keys(this.last),this.grad=new a(e,r,this.opts,i.qTipConfig(this,"Performance Data",this.opts.keys)),Object.keys(this.tmap).forEach(function(t){s.srRegisterTopic(t,this)},this)};return r.prototype.handleUpdate=function(t,s){var a;try{a=JSON.parse(s)}catch(t){return void e.debug("[Nagios/Gradient-PerfData] JSON error in performance data: "+t.message)}i.qTipUpdate(t,a,this);var r;for(r=0;r<this.tmap[t].length;r++)this.last[this.tmap[t][r]][t]=void 0;var h=0,o=!1;try{this.states[t]=a.state;for(r in this.opts.keys)if(void 0!==a.perf_data[this.opts.keys[r]]){h=parseFloat(a.perf_data[this.opts.keys[r]].val);break}for(r=0;r<this.tmap[t].length;r++)this.last[this.tmap[t][r]][t]!==h&&(this.last[this.tmap[t][r]][t]=h,o=!0)}catch(s){e.debug("[Nagios/Gradient-PerfData] Error processing performance data ["+t+"]: "+s.message)}if(!1!==o){var p,n=0,d=[];for(p in this.last){h=0;var l,f=!0;for(l in this.last[p]){var g=parseFloat(this.last[p][l]);isNaN(g)&&(g=0,f=!1),h+=g,n=Math.max(n,this.states[l])}h/=Object.keys(this.last[p]).length,isNaN(h)&&(f=!1),h<this.opts.range[0]&&(h=this.opts.range[0]),h>this.opts.range[1]&&(h=this.opts.range[1]),d[p]=f?(this.opts.hoffset+(h-this.opts.range[0])*this.opts.hscale/(this.opts.range[1]-this.opts.range[0]))%360:void 0}this.grad.update(d,n)}},r});