define(["snmd-core/js/SVGWidget","snmd-core/js/SVGImpl/StrokeWidth","snmd-widgets-nagios/js/Utils","js-logger"],function(t,s,a,o){"use strict";var i=function(o,i,e){this.opts={title:"Performance Data",desc:e,cls:t.srClassOpts(e,"StrokeWidth")},this.desc=e,void 0===this.desc.width?this.opts.width=[1,32]:this.opts.width=this.desc.width,void 0===e.keys?this.opts.keys=[e.key]:this.opts.keys=e.keys,void 0===e.factors?this.opts.factors=[]:this.opts.factors=e.factors,void 0!==e.factor?(this.opts.factor=parseFloat(e.factor),isNaN(this.opts.factor)&&(this.opts.factor=1)):this.opts.factor=1,void 0!==e.max?(this.opts.max=parseFloat(e.max),isNaN(this.opts.max)&&(this.opts.max=100)):this.opts.max=100,void 0!==e.scale?this.opts.scale=e.scale:this.opts.scale="linear",this.opts.abs=!1,void 0!==e.abs&&e.abs&&(this.opts.abs=!0),this.last=[],this.factors=[];var r;for(r=0;r<e.topics.length;r++)this.last[e.topics[r]]=[],void 0===this.opts.factors[r]?this.factors[e.topics[r]]=this.opts.factor:this.factors[e.topics[r]]=this.opts.factors[r];this.chart=new s(o,i,this.opts,a.qTipConfig(this,this.opts.keys))};return i.prototype.handleUpdate=function(t,s){var i;try{i=JSON.parse(s)}catch(t){return void o.debug("[Nagios/Stroke-PerfData] JSON error in performance data: "+t.message)}a.qTipUpdate(t,i,this),this.last[t].val=0;try{var e;for(e=0;e<this.opts.keys.length;e++)void 0!==i.perf_data[this.opts.keys[e]]&&(this.last[t].val+=parseFloat(i.perf_data[this.opts.keys[e]].val)*this.factors[t])}catch(s){o.debug("[Nagios/Stroke-PerfData] Error processing performance data ["+t+"]: "+s.message)}try{this.last[t].state=i.state}catch(s){o.debug("[Nagios/Stroke-PerfData] Error processing state data ["+t+"]: "+s.message)}var r,h=0,p=0;for(r in this.last){var c=parseFloat(this.last[r].val);isNaN(c)&&(c=0),h+=c,p=Math.max(p,this.last[r].state)}this.chart.update(h,p)},i});