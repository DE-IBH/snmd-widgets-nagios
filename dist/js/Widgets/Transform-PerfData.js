define(["snmd-core/js/SVGWidget","snmd-core/js/SVGImpl/Transform","snmd-widgets-nagios/js/Utils","js-logger"],function(s,t,a,o){"use strict";var r=function(o,r,i){this.opts={title:"Performance Data",desc:i,cls:s.srClassOpts(i,"Transform")},this.desc=i,void 0===this.desc.transform?this.opts.transform="scale(%)":this.opts.transform=this.desc.transform,void 0===i.keys?this.opts.keys=[i.key]:this.opts.keys=i.keys,void 0===i.factors?this.opts.factors=[]:this.opts.factors=i.factors,void 0!==i.factor?(this.opts.factor=parseFloat(i.factor),isNaN(this.opts.factor)&&(this.opts.factor=1)):this.opts.factor=1,void 0!==i.max?(this.opts.max=parseFloat(i.max),isNaN(this.opts.max)&&(this.opts.max=100)):this.opts.max=100,this.last=[],this.factors=[];var e;for(e=0;e<i.topics.length;e++)this.last[i.topics[e]]=[],void 0===this.opts.factors[e]?this.factors[i.topics[e]]=this.opts.factor:this.factors[i.topics[e]]=this.opts.factors[e];this.chart=new t(o,r,this.opts,a.qTipConfig(this,this.opts.keys))};return r.prototype.handleUpdate=function(s,t){var r;try{r=JSON.parse(t)}catch(s){return void o.debug("[Nagios/Transform-PerfData] JSON error in performance data: "+s.message)}a.qTipUpdate(s,r,this),this.last[s].val=0;try{var i;for(i=0;i<this.opts.keys.length;i++)void 0!==r.perf_data[this.opts.keys[i]]&&(this.last[s].val+=parseFloat(r.perf_data[this.opts.keys[i]].val)*this.factors[s])}catch(t){o.debug("[Nagios/Transform-PerfData] Error processing performance data ["+s+"]: "+t.message)}try{this.last[s].state=r.state}catch(t){o.debug("[Nagios/Transform-PerfData] Error processing state data ["+s+"]: "+t.message)}var e,h=0,p=0;for(e in this.last){var c=parseFloat(this.last[e].val);isNaN(c)&&(c=0),h+=c,p=Math.max(p,this.last[e].state)}this.chart.update(h,p)},r});