define(["snmd-core/js/SVGWidget","snmd-core/js/SVGImpl/Text","snmd-widgets-nagios/js/Utils","js-logger"],function(t,s,a,o){"use strict";var i=function(o,i,r){this.opts={desc:r,cls:t.srClassOpts(r,"Text")},this.desc=r,void 0===this.desc.uom?this.opts.uom="":this.opts.uom=this.desc.uom,void 0===r.keys?this.opts.keys=[r.key]:this.opts.keys=r.keys,void 0===r.factors?this.opts.factors=[]:this.opts.factors=r.factors,void 0!==r.factor?(this.opts.factor=parseFloat(r.factor),isNaN(this.opts.factor)&&(this.opts.factor=1)):this.opts.factor=1,void 0!==r.fracts&&(this.opts.fracts=r.fracts),this.last=[],this.factors=[];var e;for(e=0;e<r.topics.length;e++)this.last[r.topics[e]]=[],void 0===this.opts.factors[e]?this.factors[r.topics[e]]=this.opts.factor:this.factors[r.topics[e]]=this.opts.factors[e];this.chart=new s(o,i,this.opts,a.qTipConfig(this,"Performance Data",this.opts.keys))};return i.prototype.handleUpdate=function(t,s){var i;try{i=JSON.parse(s)}catch(t){return void o.debug("[Nagios/Text-PerfData] JSON error in performance data: "+t.message)}a.qTipUpdate(t,i,this),this.last[t].val=0;try{var r;for(r=0;r<this.opts.keys.length;r++)void 0!==i.perf_data[this.opts.keys[r]]&&(this.last[t].val+=parseFloat(i.perf_data[this.opts.keys[r]].val)*this.factors[t])}catch(s){o.debug("[Nagios/Text-PerfData] Error to process performance data ["+t+"]: "+s.message)}try{this.last[t].state=i.state}catch(s){o.debug("[Nagios/Text-PerfData] Error to process state data ["+t+"]: "+s.message)}var e,c=0,h=0;for(e in this.last){var p=parseFloat(this.last[e].val);isNaN(p)&&(p=0),c+=p,h=Math.max(h,this.last[e].state)}this.chart.update(c,h)},i});